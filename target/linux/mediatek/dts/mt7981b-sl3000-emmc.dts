// SPDX-License-Identifier: GPL-2.0-only OR MIT
/dts-v1/;

#include "mt7981b-filogic.dtsi"
#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/leds/common.h>
#include <dt-bindings/input/input.h>
#include <dt-bindings/clock/mt7981-clk.h>
#include <dt-bindings/reset/mt7981-reset.h>
#include <dt-bindings/pinctrl/mt7981-pinfunc.h>

/ {
	model = "SL-3000 eMMC Board (Ultimate Edition)";
	compatible = "sl,sl3000-emmc", "mediatek,mt7981";

	memory@40000000 {
		device_type = "memory";
		reg = <0x0 0x40000000 0x0 0x40000000>;
	};

	reg_3p3v: regulator-3p3v {
		compatible = "regulator-fixed";
		regulator-name = "fixed-3.3v";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
		regulator-boot-on;
	};

	reg_1p8v: regulator-1p8v {
		compatible = "regulator-fixed";
		regulator-name = "fixed-1.8v";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		regulator-always-on;
		regulator-boot-on;
	};

	reserved-memory {
		#address-cells = <1>;
		#size-cells = <1>;
		ranges;

		wed_mem: wed@47000000 {
			reg = <0x47000000 0x800000>;
			no-map;
		};

		wifi_emi: wifi@47c80000 {
			reg = <0x47c80000 0x100000>;
			no-map;
		};

		wo_emi0: wo-emi@47d80000 {
			reg = <0x47d80000 0x40000>;
			no-map;
		};

		wo_data: wo-data@47dc0000 {
			reg = <0x47dc0000 0x240000>;
			no-map;
		};
	};

	cpu_opp: opp-table {
		compatible = "operating-points-v2";
		opp-shared;

		opp-650000000 {
			opp-hz = /bits/ 64 <650000000>;
			opp-microvolt = <1000000>;
		};

		opp-850000000 {
			opp-hz = /bits/ 64 <850000000>;
			opp-microvolt = <1000000>;
		};

		opp-1000000000 {
			opp-hz = /bits/ 64 <1000000000>;
			opp-microvolt = <1000000>;
		};
	};

	leds {
		compatible = "gpio-leds";
		pinctrl-names = "default";
		pinctrl-0 = <&led_pins>;

		led_status_green: status_green {
			label = "sl3000:green:status";
			gpios = <&pio 9 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "heartbeat";
			default-state = "on";
		};

		led_status_red: status_red {
			label = "sl3000:red:fault";
			gpios = <&pio 8 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "panic";
			default-state = "off";
		};

		led_status_blue: status_blue {
			label = "sl3000:blue:wlan";
			gpios = <&pio 7 GPIO_ACTIVE_LOW>;
			linux,default-trigger = "phy0tpt";
			default-state = "off";
		};
	};

	keys {
		compatible = "gpio-keys";
		pinctrl-names = "default";
		pinctrl-0 = <&key_pins>;

		reset {
			label = "reset";
			gpios = <&pio 1 GPIO_ACTIVE_LOW>;
			linux,code = <KEY_RESTART>;
			debounce-interval = <20>;
			wakeup-source;
		};

		wps {
			label = "wps";
			gpios = <&pio 0 GPIO_ACTIVE_LOW>;
			linux,code = <KEY_WPS_BUTTON>;
			debounce-interval = <20>;
			wakeup-source;
		};
	};

	aliases {
		serial0 = &uart0;
		label-mac-device = &gmac0;
		led-boot = &led_status_green;
		led-failsafe = &led_status_red;
		led-running = &led_status_green;
		led-upgrade = &led_status_blue;
	};

	chosen {
		stdout-path = "serial0:115200n8";
	};
};

&cpu0 { operating-points-v2 = <&cpu_opp>; status = "okay"; };
&cpu1 { operating-points-v2 = <&cpu_opp>; status = "okay"; };
&cpu2 { operating-points-v2 = <&cpu_opp>; status = "okay"; };
&cpu3 { operating-points-v2 = <&cpu_opp>; status = "okay"; };

&uart0 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&uart0_pins>;
};

&watchdog { status = "okay"; timeout-sec = <30>; };
&rng { status = "okay"; };

&eth {
	status = "okay";
	mediatek,eth-wed-enable = <1>;
	mediatek,wed-memory = <&wed_mem>;
	pinctrl-names = "default";
	pinctrl-0 = <&eth_pins>;

	gmac0: mac@0 {
		compatible = "mediatek,eth-mac";
		reg = <0>;
		phy-mode = "2500base-x";
		fixed-link { speed = <2500>; full-duplex; };
	};

	mdio-bus {
		#address-cells = <1>;
		#size-cells = <0>;

		switch@1f {
			compatible = "mediatek,mt7531";
			reg = <0x1f>;
			reset-gpios = <&pio 39 GPIO_ACTIVE_LOW>;
			mediatek,reset-delay-ms = <200>;

			ports {
				#address-cells = <1>;
				#size-cells = <0>;

				port@0 { reg = <0>; label = "lan1"; };
				port@1 { reg = <1>; label = "lan2"; };
				port@2 { reg = <2>; label = "lan3"; };
				port@3 { reg = <3>; label = "lan4"; };

				port@6 {
					reg = <6>;
					label = "cpu";
					ethernet = <&gmac0>;
					phy-mode = "2500base-x";
					fixed-link { speed = <2500>; full-duplex; };
				};
			};
		};
	};
};

&mmc0 {
	status = "okay";
	bus-width = <8>;
	max-frequency = <200000000>;
	pinctrl-names = "default", "state_uhs";
	pinctrl-0 = <&mmc0_pins_default>;
	pinctrl-1 = <&mmc0_pins_uhs>;
	cap-mmc-highspeed;
	mmc-hs200-1_8v;
	mmc-hs400-1_8v;
	vmmc-supply = <&reg_3p3v>;
	vqmmc-supply = <&reg_1p8v>;
	non-removable;
	disable-wp;
};

&spi0 {
	status = "okay";
	num-cs = <1>;
	pinctrl-names = "default";
	pinctrl-0 = <&spi0_pins>;
	spi-max-frequency = <50000000>;

	flash@0 {
		compatible = "jedec,spi-nor";
		reg = <0>;
		spi-max-frequency = <50000000>;
		m25p,fast-read;

		partitions {
			compatible = "fixed-partitions";
			#address-cells = <1>;
			#size-cells = <1>;

			partition@0 {
				label = "bl2";
				reg = <0x000000 0x020000>;
				read-only;
			};

			partition@20000 {
				label = "u-boot-env";
				reg = <0x020000 0x020000>;
			};

			factory: partition@40000 {
				label = "factory";
				reg = <0x040000 0x040000>;
				read-only;
			};

			partition@80000 {
				label = "fip";
				reg = <0x080000 0x180000>;
				read-only;
			};

			partition@200000 {
				label = "recovery";
				reg = <0x200000 0x2000000>;
			};
		};
	};
};
