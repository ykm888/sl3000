name: DTS Build (OpenWrt)

on:
  push:
    paths:
      - 'target/linux/mediatek/files-6.12/arch/arm64/boot/dts/mediatek/**'
  pull_request:
    paths:
      - 'target/linux/mediatek/files-6.12/arch/arm64/boot/dts/mediatek/**'
  workflow_dispatch:   # üëà ÊâãÂä®ËøêË°åÊåâÈíÆ

jobs:
  dts-build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install build dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential flex bison gawk gettext \
            libncurses5-dev libssl-dev python3 unzip zlib1g-dev device-tree-compiler ccache m4

      - name: Prepare OpenWrt toolchain
        run: |
          make tools/install V=s
          make toolchain/install V=s

      - name: Build target linux (includes DTS ‚Üí DTB)
        run: |
          make target/linux/compile V=s

      - name: Verify DTB output
        run: |
          TARGET_DIR="bin/targets/mediatek/filogic"
          if ls $TARGET_DIR/*.dtb >/dev/null 2>&1; then
            echo "‚úÖ DTS compiled successfully, DTB files are in $TARGET_DIR"
          else
            echo "‚ùå DTS compilation failed, no DTB generated"
            exit 1
          fi
